---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:14
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:14
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:14
    commands:
      - npm test

  - name: check-coverage
    image: node:14
    commands:
      - npm run coverage

  - name: build
    image: node:14
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: AwntXVdThNkIPwHoJg+KCINiEW2TP9nM6V+uIT+um+MPiDN/YlwVSRI0lsJpHrumqr+wCPZLBje/Tfjsp2al4Q==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 323239305d4da8dce1e880e711140e4dfdf106884b9c0989f58e40f913dd6c81

...
